<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Mezzio Example: Testing Doctrine Entities and Repositories - Marc Guyer</title>
<meta name=description content="Overview
In this post, we&rsquo;ll see how to create a comprehensive testing framework for Doctrine Entities and Repositories. This is a continuation of our Mezzio Example series where we previously created our domain model for an OAuth2-enabled application.
Let&rsquo;s make sure our Entities and Repositories have full test coverage. The domain model is a significant part of any dynamic application so the code should be in good shape. We don&rsquo;t want any bugs here."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Marc Guyer","url":"\/\/marc.guyer.me\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"\/\/marc.guyer.me\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"\/\/marc.guyer.me\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/\/marc.guyer.me\/posts\/mezzio-example\/testing-doctrine-entities-and-repositories\/","name":"Mezzio example testing doctrine entities and repositories"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"Mezzio Example: Testing Doctrine Entities and Repositories","description":"Overview In this post, we\u0026rsquo;ll see how to create a comprehensive testing framework for Doctrine Entities and Repositories. This is a continuation of our Mezzio Example series where we previously created our domain model for an OAuth2-enabled application.\nLet\u0026rsquo;s make sure our Entities and Repositories have full test coverage. The domain model is a significant part of any dynamic application so the code should be in good shape. We don\u0026rsquo;t want any bugs here.\n","inLanguage":"en","wordCount":1116,"datePublished":"2021-09-16T16:25:49-05:00","dateModified":"2025-05-15T20:46:25-04:00","image":"https:\/\/www.gravatar.com\/avatar\/e96773ada2643a59cf32d6e1407a7cc8?s=512","keywords":["php, mezzio, laminas, prophecy, phpunit, doctrine, oauth2"],"mainEntityOfPage":"\/\/marc.guyer.me\/posts\/mezzio-example\/testing-doctrine-entities-and-repositories\/","publisher":{"@type":"Organization","name":"\/\/marc.guyer.me\/","logo":{"@type":"ImageObject","url":"https:\/\/www.gravatar.com\/avatar\/e96773ada2643a59cf32d6e1407a7cc8?s=512","height":60,"width":60}}}</script><meta property="og:title" content="Mezzio Example: Testing Doctrine Entities and Repositories"><meta property="og:description" content="Overview
In this post, we&rsquo;ll see how to create a comprehensive testing framework for Doctrine Entities and Repositories. This is a continuation of our Mezzio Example series where we previously created our domain model for an OAuth2-enabled application.
Let&rsquo;s make sure our Entities and Repositories have full test coverage. The domain model is a significant part of any dynamic application so the code should be in good shape. We don&rsquo;t want any bugs here."><meta property="og:image" content="https://www.gravatar.com/avatar/e96773ada2643a59cf32d6e1407a7cc8?s=512"><meta property="og:url" content="//marc.guyer.me/posts/mezzio-example/testing-doctrine-entities-and-repositories/"><meta property="og:type" content="website"><meta property="og:site_name" content="Marc Guyer"><meta name=twitter:title content="Mezzio Example: Testing Doctrine Entities and Repositories"><meta name=twitter:description content="Overview
In this post, we&rsquo;ll see how to create a comprehensive testing framework for Doctrine Entities and Repositories. This is a continuation of our Mezzio Example series where we previously â€¦"><meta name=twitter:image content="https://www.gravatar.com/avatar/e96773ada2643a59cf32d6e1407a7cc8?s=512"><meta name=twitter:card content="summary_large_image"><link href='https://www.gravatar.com/avatar/e96773ada2643a59cf32d6e1407a7cc8?s=512' rel=icon type=image/x-icon><meta name=generator content="Hugo 0.147.3"><link rel=alternate href=//marc.guyer.me/index.xml type=application/rss+xml title="Marc Guyer"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=//marc.guyer.me/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=//marc.guyer.me/css/syntax.css><link rel=stylesheet href=//marc.guyer.me/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=UA-69610431-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-69610431-1")</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=//marc.guyer.me/>Marc Guyer</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Posts href=/posts/>Posts</a></li><li><a title=About href=/about/>About</a></li><li><a title=Contact href=/contact/>Contact</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Marc Guyer" href=//marc.guyer.me/><img class=avatar-img src="https://www.gravatar.com/avatar/e96773ada2643a59cf32d6e1407a7cc8?s=512" alt="Marc Guyer"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-heading><h1>Mezzio Example: Testing Doctrine Entities and Repositories</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h2 id=overview>Overview</h2><p>In this post, we&rsquo;ll see how to create a comprehensive testing framework for Doctrine Entities and Repositories. This is a continuation of our <a href=/posts/mezzio-example/doctrine-entities-and-repositories/>Mezzio Example series</a> where we previously created our domain model for an OAuth2-enabled application.</p><p>Let&rsquo;s make sure our Entities and Repositories have full test coverage. The domain model is a significant part of any dynamic application so the code should be in good shape. We don&rsquo;t want any bugs here.</p><p>Since Doctrine plays by a strict set of rules, we can create a simple testing framework based on those assumptions. We know the naming convention of the getters and setters, and we know the relationship between entity properties and those accessors. Further, we can use Doctrine&rsquo;s own ClassMetadata to ensure that we cover everything.</p><p>This post will demonstrate a reusable abstract test class that leverages PHP reflection and Doctrine&rsquo;s metadata to automatically test every property, getter, and setter in our entities with minimal boilerplate code.</p><p>The framework is a magic box of sorts. As I said, some rules must be followed and the assumptions must hold true for this test framework to be of value. If it doesn&rsquo;t work for one of your properties, or you have some extra methods in there unrelated to class properties and their accessors, you can always add test methods to test those outliers.</p><h2 id=a-doctrine-entity-test-abstract>A Doctrine Entity Test Abstract</h2><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-DataTest-Entity-AbstractEntityTest-php aria-expanded=false aria-controls=collapseExample>DataTest\Entity\AbstractEntityTest.php</a><div class=collapse id=collapseExample-DataTest-Entity-AbstractEntityTest-php><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: test/DataTest/Entity/AbstractEntityTest.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=entities-to-support-oauth2-requirements>Entities to Support OAuth2 Requirements</h3><p>We&rsquo;ll start by defining a minimum domain model via PHP8 Attributes and Doctrine&rsquo;s new attribute mapping driver. In the short-term, we only need to model what&rsquo;s necessary for our application&rsquo;s authentication layer using OAuth2. For now, we&rsquo;re creating a minimal set of objects to comply with the needs of our supporting libraries&rsquo; interfaces. We need a minimum of 6 entities and their corresponding repositories:</p><ul><li>User</li><li>OAuthClient</li><li>OAuthAuthCode</li><li>OAuthAccessToken</li><li>OAuthRefreshToken</li><li>OAuthScope</li></ul><p>Mezzio includes an implementation of Alex Bilbie&rsquo;s wonderful, spec-compliant <a href=https://oauth2.thephpleague.com/>OAuth2 Server</a> as <a href=https://docs.mezzio.dev/mezzio-authentication-oauth2/>an adapter</a> to the <a href=https://docs.mezzio.dev/mezzio-authentication/>Mezzio authentication abstraction middleware component</a>. Both the server library and the Mezzio authentication component provide various interfaces for which we&rsquo;ll need to provide concrete implementations. We&rsquo;ll do that while building our domain model with <a href=#entities>Entities</a> and <a href=#repositories>Repositories</a>.</p><h3 id=psalm-changes-required-for-error-level-1>Psalm Changes Required for Error Level 1</h3><h4 id=entity-changes>Entity Changes</h4><p>TLDR; All errors required suppression notation to pass. Check this diff for the details: <a href=https://github.com/marcguyer/mezzio-doctrine-oauth2-example/commit/5640b45bb942d577af0f4e3606f30bc91b6105c5>https://github.com/marcguyer/mezzio-doctrine-oauth2-example/commit/5640b45bb942d577af0f4e3606f30bc91b6105c5</a></p><h4 id=repository-changes>Repository Changes</h4><p><a href=https://github.com/marcguyer/mezzio-doctrine-oauth2-example/commit/df7e770f32137ec1c26bad02eb971421058f5a63>https://github.com/marcguyer/mezzio-doctrine-oauth2-example/commit/df7e770f32137ec1c26bad02eb971421058f5a63</a></p><h2 id=entities>Entities</h2><p>An Entity is a persist-able PHP data object with an identity. Generally speaking, an entity represents a database table as a native PHP object with properties that correspond with the table columns.</p><p>We&rsquo;ll create a set of entities fulfilling the minimum requirements of both Mezzio Authentication and the corresponding OAuth2 library.</p><h3 id=user-entity>User Entity</h3><p>A <em>User</em> represents an unique individual person in our domain model. The <em>User</em> entity will need to implement both the OAuth2 Server library user interface and Mezzio Authentication component&rsquo;s user interface:</p><h4 id=implemented-interfaces>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-UserEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\UserEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-UserEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/UserEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Mezzio-Authentication-UserInterface aria-expanded=false aria-controls=collapseExample>Mezzio\Authentication\UserInterface</a><div class=collapse id=collapseExample-Mezzio-Authentication-UserInterface><pre tabindex=0><code>[GitHub file content from repo: mezzio/mezzio-authentication, path: src/UserInterface.php, ref: 1.2.1]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-User aria-expanded=false aria-controls=collapseExample>Data\Entity\User</a><div class=collapse id=collapseExample-Data-Entity-User><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/User.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthclient-entity>OAuthClient Entity</h3><h4 id=implemented-interfaces-1>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-ClientEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\ClientEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-ClientEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/ClientEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Mezzio-Authentication-UserInterface aria-expanded=false aria-controls=collapseExample>Mezzio\Authentication\UserInterface</a><div class=collapse id=collapseExample-Mezzio-Authentication-UserInterface><pre tabindex=0><code>[GitHub file content from repo: mezzio/mezzio-authentication, path: src/UserInterface.php, ref: 1.2.1]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-1>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-OAuthClient aria-expanded=false aria-controls=collapseExample>Data\Entity\OAuthClient</a><div class=collapse id=collapseExample-Data-Entity-OAuthClient><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/OAuthClient.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthauthcode-entity>OAuthAuthCode Entity</h3><h4 id=implemented-interfaces-2>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-AuthCodeEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\AuthCodeEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-AuthCodeEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/AuthCodeEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-2>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-OAuthAuthCode aria-expanded=false aria-controls=collapseExample>Data\Entity\OAuthAuthCode</a><div class=collapse id=collapseExample-Data-Entity-OAuthAuthCode><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/OAuthAuthCode.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthaccesstoken-entity>OAuthAccessToken Entity</h3><h4 id=implemented-interfaces-3>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-AccessTokenEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\AccessTokenEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-AccessTokenEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/AccessTokenEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-3>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-OAuthAccessToken aria-expanded=false aria-controls=collapseExample>Data\Entity\OAuthAccessToken</a><div class=collapse id=collapseExample-Data-Entity-OAuthAccessToken><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/OAuthAccessToken.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthrefreshtoken-entity>OAuthRefreshToken Entity</h3><h4 id=implemented-interfaces-4>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-RefreshTokenEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\RefreshTokenEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-RefreshTokenEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/RefreshTokenEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-4>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-OAuthRefreshToken aria-expanded=false aria-controls=collapseExample>Data\Entity\OAuthRefreshToken</a><div class=collapse id=collapseExample-Data-Entity-OAuthRefreshToken><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/OAuthRefreshToken.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthscope-entity>OAuthScope Entity</h3><h4 id=implemented-interfaces-5>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Entities-ScopeEntityInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Entities\ScopeEntityInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Entities-ScopeEntityInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Entities/ScopeEntityInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-5>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Entity-OAuthScope aria-expanded=false aria-controls=collapseExample>Data\Entity\OAuthScope</a><div class=collapse id=collapseExample-Data-Entity-OAuthScope><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Entity/OAuthScope.php, ref: 5640b45bb942d577af0f4e3606f30bc91b6105c5]
(GitHub API integration temporarily disabled)
</code></pre></div><h2 id=repositories>Repositories</h2><h3 id=user-repository>User Repository</h3><p>The <em>User</em> repository will need to implement both the OAuth2 Server library user repository interface and Mezzio Authentication component&rsquo;s user repository interface:</p><h4 id=implemented-interfaces-6>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-UserRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\UserRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-UserRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/UserRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Mezzio-Authentication-UserRepositoryInterface aria-expanded=false aria-controls=collapseExample>Mezzio\Authentication\UserRepositoryInterface</a><div class=collapse id=collapseExample-Mezzio-Authentication-UserRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: mezzio/mezzio-authentication, path: src/UserRepositoryInterface.php, ref: 1.2.1]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-6>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-UserRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\UserRepository</a><div class=collapse id=collapseExample-Data-Repository-UserRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/UserRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthclient-repository>OAuthClient Repository</h3><p>The <em>Client</em> repository will need to implement only the OAuth2 Server library client repository interface:</p><h4 id=implemented-interfaces-7>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-ClientRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\ClientRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-ClientRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/ClientRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-7>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-OAuthClientRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\OAuthClientRepository</a><div class=collapse id=collapseExample-Data-Repository-OAuthClientRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/OAuthClientRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthauthcode-repository>OAuthAuthCode Repository</h3><p>The <em>AuthCode</em> repository will need to implement only the OAuth2 Server library authcode repository interface:</p><h4 id=implemented-interfaces-8>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-AuthCodeRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\AuthCodeRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-AuthCodeRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/AuthCodeRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-8>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-OAuthAuthCodeRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\OAuthAuthCodeRepository</a><div class=collapse id=collapseExample-Data-Repository-OAuthAuthCodeRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/OAuthAuthCodeRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthaccesstoken-repository>OAuthAccessToken Repository</h3><p>The <em>AccessToken</em> repository will need to implement only the OAuth2 Server library accesstoken repository interface:</p><h4 id=implemented-interfaces-9>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-AccessTokenRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\AccessTokenRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-AccessTokenRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/AccessTokenRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-9>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-OAuthAccessTokenRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\OAuthAccessTokenRepository</a><div class=collapse id=collapseExample-Data-Repository-OAuthAccessTokenRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/OAuthAccessTokenRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthrefreshtoken-repository>OAuthRefreshToken Repository</h3><p>The <em>RefreshToken</em> repository will need to implement only the OAuth2 Server library refreshtoken repository interface:</p><h4 id=implemented-interfaces-10>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-RefreshTokenRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\RefreshTokenRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-RefreshTokenRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/RefreshTokenRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-10>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-OAuthRefreshTokenRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\OAuthRefreshTokenRepository</a><div class=collapse id=collapseExample-Data-Repository-OAuthRefreshTokenRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/OAuthRefreshTokenRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h3 id=oauthscope-repository>OAuthScope Repository</h3><p>The <em>Scope</em> repository will need to implement only the OAuth2 Server library scope repository interface:</p><h4 id=implemented-interfaces-11>Implemented Interfaces</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-League-OAuth-Server-Repositories-ScopeRepositoryInterface aria-expanded=false aria-controls=collapseExample>League\OAuth2\Server\Repositories\ScopeRepositoryInterface</a><div class=collapse id=collapseExample-League-OAuth-Server-Repositories-ScopeRepositoryInterface><pre tabindex=0><code>[GitHub file content from repo: thephpleague/oauth2-server, path: src/Repositories/ScopeRepositoryInterface.php, ref: 8.3.2]
(GitHub API integration temporarily disabled)
</code></pre></div><h4 id=implementation-11>Implementation</h4><a class="btn btn-primary btn-githubfile" role=button data-toggle=collapse href=#collapseExample-Data-Repository-OAuthScopeRepository aria-expanded=false aria-controls=collapseExample>Data\Repository\OAuthScopeRepository</a><div class=collapse id=collapseExample-Data-Repository-OAuthScopeRepository><pre tabindex=0><code>[GitHub file content from repo: marcguyer/mezzio-doctrine-oauth2-example, path: src/Data/Repository/OAuthScopeRepository.php, ref: df7e770f32137ec1c26bad02eb971421058f5a63]
(GitHub API integration temporarily disabled)
</code></pre></div><h2 id=conclusion>Conclusion</h2><p>This post has explored a simple framework for easily testing Doctrine Entities and Repositories without writing much code. By leveraging Doctrine&rsquo;s metadata system and class reflection, we can automate testing of property getters and setters, ensuring our domain model is well-tested and reliable.</p><div class=blog-tags><a href=//marc.guyer.me//tags/php/>php</a>&nbsp;
<a href=//marc.guyer.me//tags/mezzio/>mezzio</a>&nbsp;
<a href=//marc.guyer.me//tags/laminas/>laminas</a>&nbsp;
<a href=//marc.guyer.me//tags/prophecy/>prophecy</a>&nbsp;
<a href=//marc.guyer.me//tags/phpunit/>phpunit</a>&nbsp;
<a href=//marc.guyer.me//tags/doctrine/>doctrine</a>&nbsp;
<a href=//marc.guyer.me//tags/oauth2/>oauth2</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f&amp;text=Mezzio%20Example%3a%20Testing%20Doctrine%20Entities%20and%20Repositories&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f&amp;title=Mezzio%20Example%3a%20Testing%20Doctrine%20Entities%20and%20Repositories" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f&amp;title=Mezzio%20Example%3a%20Testing%20Doctrine%20Entities%20and%20Repositories" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f&amp;title=Mezzio%20Example%3a%20Testing%20Doctrine%20Entities%20and%20Repositories" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=%2f%2fmarc.guyer.me%2fposts%2fmezzio-example%2ftesting-doctrine-entities-and-repositories%2f&amp;description=Mezzio%20Example%3a%20Testing%20Doctrine%20Entities%20and%20Repositories" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><ul class="pager blog-pager series-pager"><li class=previous><a href=/posts/mezzio-example/doctrine-entities-and-repositories/ data-toggle=tooltip data-placement=top title="Mezzio Example: Doctrine Entities and Repositories">&larr; Previous in Series</a></li></ul><h4 class=see-also>Series: Mezzio Example</h4><ol><li><a href=/posts/mezzio-example/introduction/>Mezzio Example: Introduction</a></li><li><a href=/posts/mezzio-example/functional-and-unit-testing/>Mezzio Example: Functional and Unit Testing</a></li><li><a href=/posts/mezzio-example/psalm-introduction/>Mezzio Example: Psalm Introduction</a></li><li><a href=/posts/mezzio-example/doctrine-entities-and-repositories/>Mezzio Example: Doctrine Entities and Repositories</a></li><li>Mezzio Example: Testing Doctrine Entities and Repositories</li></ol><h4 class=see-also>See also</h4><ul><li><a href=/posts/bref-php-pdo-postgresql-multi-architecture-example/>Building Multi-Architecture AWS Lambda Functions with Bref PHP and PostgreSQL</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=//marc.guyer.me/posts/mezzio-example/doctrine-entities-and-repositories/ data-toggle=tooltip data-placement=top title="Mezzio Example: Doctrine Entities and Repositories">&larr; Previous Post</a></li><li class=next><a href=//marc.guyer.me/posts/bref-php-pdo-postgresql-multi-architecture-example/ data-toggle=tooltip data-placement=top title="Building Multi-Architecture AWS Lambda Functions with Bref PHP and PostgreSQL">Next Post &rarr;</a></li></ul><div class=disqus-comments><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname="marcguyer",disqus_config=function(){this.page.url="//marc.guyer.me/posts/mezzio-example/testing-doctrine-entities-and-repositories/",this.page.identifier="//marc.guyer.me/posts/mezzio-example/testing-doctrine-entities-and-repositories/"};(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=//marc.guyer.me/>Marc Guyer</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.147.3</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
&nbsp;&bull;&nbsp;[<a href=https://github.com/marcguyer/marcguyer.github.io/commit/a253258841463454be3fa2830832fb4eb5cd39d3>a2532588</a>]</p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=//marc.guyer.me/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=//marc.guyer.me/js/load-photoswipe.js></script></body></html>